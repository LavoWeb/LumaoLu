<!doctype html><html lang=fr-lu><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Comment brancher le Cloud Magento 2 sur un repo Gitlab ?</title><meta name=description content><meta name=robots content="INDEX,FOLLOW"><link rel=apple-touch-icon sizes=180x180 href=https://lu.lumao.eu/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://lu.lumao.eu/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://lu.lumao.eu/favicon-16x16.png><link rel=manifest href=https://lu.lumao.eu/site.webmanifest><link rel=mask-icon href=https://lu.lumao.eu/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#da532c"><link rel=alternate hreflang=fr-fr href=https://lumao.eu/post/adobecloud-gitlab/><link rel=alternate hreflang=x-default href=https://lumao.eu/post/adobecloud-gitlab/><link rel=alternate hreflang=fr-ch href=https://lumao.ch/post/adobecloud-gitlab/><link rel=alternate hreflang=fr-be href=https://be.lumao.eu/post/adobecloud-gitlab/><link rel=alternate hreflang=fr-lu href=https://lu.lumao.eu/post/adobecloud-gitlab/><meta name=generator content="Hugo 0.63.0-DEV"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PXRXBBS');</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PXRXBBS" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><header class=header><div class=container><div class=row><div class=col-sm-3><a class="animsition-link site-logo" href=https://lu.lumao.eu/><img src=https://lu.lumao.eu/agence_magento.svg alt="Lumao - Développement Magento"></a></div><div class=col-sm-9><nav id=site-nav class=nav-toggle><ul class=menu><li><a href=https://lu.lumao.eu/><i class="fa fa-code" aria-hidden=true></i>Développeur Magento</a><li><a href=https://lu.lumao.eu/ecommerce/cms/magento/><i class="fa fa-codepen" aria-hidden=true></i>Magento</a><li><a href=# data-goto=/reference/><i class="fa fa-connectdevelop" aria-hidden=true></i>Réalisations</a><li><a href=# data-goto=/post/contact/><i class="fa fa-comments" aria-hidden=true></i>Contact</a></ul></nav></div></div></div></header><div class="section section-content" id=section-content><div class=title-block><h1 class=title-big>Comment brancher le Cloud Magento 2 sur un repo Gitlab ?</h1></div><div class=container><div class=row><div class="col-md-12 about-info"><p>Comment brancher le Cloud Magento/Adobe sur un repo Gitlab ?<h2 id=etape-1--crer-un-token-sur-un-utilisateur-gitlab>Etape 1 : créer un token sur un utilisateur Gitlab</h2><p>On va sur notre instance Gitlab, Profil => Settings => Access Tokens => Add a personal access token<p><img src=/images/25/1-creer-token.png alt="créer un token sur un utilisateur Gitlab"><p>Ce qui donne :<p><img src=/images/25/2-affichage-token.png alt="résultat création token gitlab"><h2 id=etape-2--installer-le-phar-magento-cloud>Etape 2 : installer le phar magento-cloud</h2><p><a href=https://devdocs.magento.com/cloud/before/before-workspace-magento-prereqs.html#cloud-ssh-cli-cli-install>https://devdocs.magento.com/cloud/before/before-workspace-magento-prereqs.html#cloud-ssh-cli-cli-install</a><h2 id=etape-3--faire-le-lien-dans-magento-cloud>Etape 3 : faire le lien dans Magento Cloud</h2><p>Tout est dans la commande <strong>magento-cloud integration:add</strong>, il y a une GUI qui permets de faire la suite. Voici les options que j'ai utilisé :<pre><code>magento-cloud integration:add --type=gitlab --project=1234 --base-url=https://gitlab.com --token=567 --server-project=lavoweb/example.com --build-merge-requests=Y --merge-requests-clone-parent-data=Y --fetch-branches=Y --prune-branches=n
</code></pre><p>Pour connaitre le &ldquo;project&rdquo; :<pre><code>magento-cloud
+---------------+-------------------+---------------------------------------------------+
| ID            | Title             | URL                                               |
+---------------+-------------------+---------------------------------------------------+
| 1234          | Lumao        SASU | https://eu-1.magento.cloud/projects/1234          |
+---------------+-------------------+---------------------------------------------------+
</code></pre><p>Le &ldquo;base-url&rdquo; correspond à l'url d'installation de votre Gitlab. Celui en SaaS pour moi.<p>Le &ldquo;token&rdquo; correspond à ce qu'on a récupèrer dans l'étape 1.<p>Le &ldquo;server-project&rdquo; correspond au path de votre projet dans Gitlab.<p>Pour le reste c'est assez clair.<p>Voici ce qu'on est censé obtenir :<pre><code>Checking webhook configuration on the repository: https://gitlab.com/lavoweb/example.com
  Creating new webhook
  Webhook created successfully
Created integration 89 (type: gitlab)
+----------------------------------+---------------------------------------------------------------------------------------+
| Property                         | Value                                                                                 |
+----------------------------------+---------------------------------------------------------------------------------------+
| id                               | 89                                                                                    |
| type                             | gitlab                                                                                |
| token                            | ******                                                                                |
| base_url                         | https://gitlab.com                                                                    |
| project                          | lavoweb/example.com                                                                   |
| fetch_branches                   | true                                                                                  |
| prune_branches                   | false                                                                                 |
| build_merge_requests             | true                                                                                  |
| merge_requests_clone_parent_data | true                                                                                  |
| hook_url                         | https://eu-1.magento.cloud/api/projects/1234/integrations/89/hook                     |
+----------------------------------+---------------------------------------------------------------------------------------+
</code></pre><p>On garde précieusement le hook_url.<h2 id=etape-4--hook>Etape 4 : Hook</h2><p>Pour que Gitlab prévienne Magento des changements de code on utilise des hooks, si on a été bon, ils devraient avoir été créés.<p>Pour vérifier cela, on va sur notre projet dans Gitlab, Settings => Integrations => Project Hooks<p><img src=/images/25/3-hook.png alt="vérification hook gitlab"></div></div></div></div><footer class=footer-bottom><p class=copyright>&copy; 2020 Lumao SASU <img src=https://lu.lumao.eu/favicon-32x32.png alt="agence web Lumao" class=copyright__logo> - 835 305 657 R.C.S. Annecy - Développé avec <i class="fa fa-heart-o"></i>par LavoWeb -<p class=copyright>Nous nous déplaçons sur Luxembourg, Esch-alzette, Dudelange, Schifflange<p class=copyright>Le nom "Magento", "Magento 2" et le logo sont des marques commerciales de Magento, Inc.</footer><link rel=stylesheet href=https://lu.lumao.eu/dist/all.css><script src=https://lu.lumao.eu/dist/all.js></script><script>jQuery(document).ready(function(){jQuery('img').each(function(){jQuery(this).addClass('img-responsive');});jQuery('h2').each(function(){jQuery(this).addClass('title-middle');});});window.addEventListener('DOMContentLoaded',function(){var myLazyLoad=new LazyLoad({elements_selector:".lazy"});var myLazyLoadWebp=new LazyLoad({elements_selector:".lazy-webp",to_webp:true});},false);if(window.location.href.indexOf('post')==-1){window.$crisp=[];window.CRISP_WEBSITE_ID="b48f7286-9c82-45c3-9efd-449ced615937";(function(){d=document;s=d.createElement("script");s.src="https://client.crisp.chat/l.js";s.async=1;d.getElementsByTagName("head")[0].appendChild(s);})();}</script>